<head>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <pre id="output"></pre>

  <script>

    // CREATE MATRIX
    const matrix = [];
    const startNum = Math.floor(Math.random() * 9) + 1;
    const output = document.getElementById("output");
    let result = "";

    // filling first row
    const firstRow = [];
    for (let i = 0; i < 9; i++) {
      let value = startNum + i;
      if (value > 9) value -= 9;
      firstRow.push(value);
    }
    matrix.push(firstRow);

    // filling other rows
    for (let row = 1; row < 9; row++) {
      const prevRow = matrix[row - 1];
      const newRow = [];

      // every third row adds 4, others add 3 to the number
      const increment = (row + 1) % 3 === 0 ? 4 : 3;

      for (let col = 0; col < 9; col++) {
        let value = prevRow[col] + increment;
        if (value > 9) value -= 9;
        newRow.push(value);
      }

      matrix.push(newRow);
    }

    // swap rows
    function swapRowsInBlock(matrix, blockIndex) {
      const base = blockIndex * 3;
      let row1 = base + Math.floor(Math.random() * 3);
      let row2 = base + Math.floor(Math.random() * 3);

      while (row1 === row2) {
        row2 = base + Math.floor(Math.random() * 3);
      }

      [matrix[row1], matrix[row2]] = [matrix[row2], matrix[row1]];
    }

    // swap rows in every "three rows" block
    for (let block = 0; block < 3; block++) {
      swapRowsInBlock(matrix, block);
      swapRowsInBlock(matrix, block);
    }

    // DELET MATRIX NUMBERS
    // check if it is possible to put num in (row, col) without conflicts
function isValid(board, row, col, num) {
  for (let i = 0; i < 9; i++) {
    if (board[row][i] === num) return false;    
    if (board[i][col] === num) return false;     
  }
  const boxRow = Math.floor(row / 3) * 3;
  const boxCol = Math.floor(col / 3) * 3;
  for (let r = 0; r < 3; r++) {
    for (let c = 0; c < 3; c++) {
      if (board[boxRow + r][boxCol + c] === num) return false;
    }
  }
  return true;
}

// find a solution (less than 2)
function solveSudokuCount(board, count = {num:0}) {
  for (let row = 0; row < 9; row++) {
    for (let col = 0; col < 9; col++) {
      if (board[row][col] === '*') {  // epmty clot
        for (let num = 1; num <= 9; num++) {
          if (isValid(board, row, col, num)) {
            board[row][col] = num;
            solveSudokuCount(board, count);
            if (count.num > 1) return; // more then 1 solution = stop
            board[row][col] = ' '; //*
          }
        }
        return; // no solutions = exit
      }
    }
  }
  count.num++;
}

// create unique solution
function createPuzzle(board, toRemove = 40) {
  let removed = 0;
  const positions = [];
  // collect all positions
  for (let r=0; r<9; r++) {
    for (let c=0; c<9; c++) {
      positions.push([r,c]);
    }
  }
  
  // mix positions
  positions.sort(() => Math.random() - 0.5);
  
  for (let [r,c] of positions) {
    if (removed >= toRemove) break;
    
    const temp = board[r][c];
    board[r][c] = ' '; //*
    
    // create copy to compare solution
    const copyBoard = board.map(row => row.slice());
    let count = {num: 0};
    solveSudokuCount(copyBoard, count);
    
    if (count.num !== 1) {
      // if solution is not 1 = remove
      board[r][c] = temp;
    } else {
      removed++;
    }
  }
  return board;
}

    // SHOW RESULT
    createPuzzle(matrix, 40); 
    

    /*for (let i = 0; i < 9; i++) {
    if (i % 3 === 0 && i !== 0) result += "------+-------+------\n"; 

    for (let j = 0; j < 9; j++) {
      if (j % 3 === 0 && j !== 0) result += "| ";
      result += matrix[i][j] + " ";
    }

    result += "\n";
  }
  output.textContent = result;*/

    const container = document.createElement('div');
    container.style.margin = 'auto';
container.style.display = 'grid';
container.style.gridTemplateColumns = 'repeat(9, 40px)';
container.style.gridGap = '0';
document.body.appendChild(container);

for (let i = 0; i < 9; i++) {
  for (let j = 0; j < 9; j++) {
    const btn = document.createElement('button');
    btn.textContent = matrix[i][j];
    btn.style.width = '40px';
    btn.style.height = '40px';

    // separate 3*3 blocks
    btn.style.borderTop = i % 3 === 0 ? '3px solid black' : '1px solid gray';
    btn.style.borderLeft = j % 3 === 0 ? '3px solid black' : '1px solid gray';
    btn.style.borderRight = j === 8 ? '3px solid black' : '';
    btn.style.borderBottom = i === 8 ? '3px solid black' : '';

    container.appendChild(btn);
  }
}

    //buttons
    /*const btn = document.createElement('button');
btn.textContent = 'ONE';
btn.classList.add('left-button');
document.body.appendChild(btn);*/
    
  </script>
</body>
